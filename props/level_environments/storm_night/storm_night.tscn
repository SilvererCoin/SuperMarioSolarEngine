[gd_scene load_steps=36 format=3 uid="uid://btpluqyw0y5gx"]

[ext_resource type="Script" uid="uid://ccysh3ski6mvh" path="res://props/level_environments/environment.gd" id="1_llem3"]
[ext_resource type="Shader" uid="uid://8m5bl0huf1e0" path="res://clouds.gdshader" id="2_6acqj"]
[ext_resource type="Shader" uid="uid://d3mu7r0k43ykr" path="res://props/level_environments/storm_night/sky_gradient.gdshader" id="2_a6wt5"]
[ext_resource type="Shader" uid="uid://cffcw4np2dlxl" path="res://props/level_environments/storm_night/back_clouds.gdshader" id="4_y7kw2"]
[ext_resource type="Texture2D" uid="uid://c3f80sey2r8fq" path="res://props/level_environments/storm_night/cloud_back.png" id="5_338ij"]
[ext_resource type="Script" uid="uid://dgxem1pkwavnf" path="res://props/level_environments/storm_night/cloud_polygon_generator.gd" id="5_b4j02"]
[ext_resource type="Shader" uid="uid://cg8n02xxlwrs2" path="res://props/level_environments/storm_night/cloud.gdshader" id="6_0nril"]

[sub_resource type="Gradient" id="Gradient_a6wt5"]
offsets = PackedFloat32Array(0, 0.5077605, 1)
colors = PackedColorArray(0, 0, 0, 1, 0.1716, 0.1716, 0.39, 1, 0.25800002, 0.25800002, 0.86, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_6acqj"]
gradient = SubResource("Gradient_a6wt5")

[sub_resource type="Gradient" id="Gradient_lpqep"]
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_p41gt"]
gradient = SubResource("Gradient_lpqep")
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(1, 0.5)

[sub_resource type="Environment" id="Environment_6acqj"]
background_mode = 3
background_color = Color(0.08932503, 0.0729, 0.27, 1)
ambient_light_source = 2
ambient_light_color = Color(1, 1, 1, 1)
ambient_light_energy = 0.17
reflected_light_source = 1

[sub_resource type="ShaderMaterial" id="ShaderMaterial_6acqj"]
render_priority = 0
shader = ExtResource("2_6acqj")
shader_parameter/height_scale = 0.5
shader_parameter/wave_speed = 0.2
shader_parameter/upper_transparency = 1.0
shader_parameter/global_transparency = 1.0
shader_parameter/time_factor = Vector2(3, 0)
shader_parameter/uv1_scale = Vector3(0, 0, 0)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/color1 = Color(0, 0.26712608, 0.56223154, 1)
shader_parameter/color2 = Color(0, 0.391379, 0.6329367, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_y7kw2"]
material = SubResource("ShaderMaterial_6acqj")
size = Vector2(6, 2)
subdivide_width = 1536
subdivide_depth = 512

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0nril"]
render_priority = 0
shader = ExtResource("2_6acqj")
shader_parameter/height_scale = 0.5
shader_parameter/wave_speed = 0.2
shader_parameter/upper_transparency = 1.0
shader_parameter/global_transparency = 1.0
shader_parameter/time_factor = Vector2(3, 0)
shader_parameter/uv1_scale = Vector3(0, 0, 0)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/color1 = Color(0, 0.26712608, 0.56223154, 1)
shader_parameter/color2 = Color(0, 0.391379, 0.6329367, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_b4j02"]
material = SubResource("ShaderMaterial_0nril")
size = Vector2(6, 2)
subdivide_width = 1536
subdivide_depth = 512

[sub_resource type="Curve" id="Curve_6acqj"]
_data = [Vector2(0, 0.25), 0.0, -0.85, 0, 0, Vector2(0.5, 0), 0.0, 0.0, 0, 0, Vector2(1, 0.25), 0.85, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_y7kw2"]
curve = SubResource("Curve_6acqj")

[sub_resource type="Gradient" id="Gradient_338ij"]
offsets = PackedFloat32Array(0.27764127, 0.8)
colors = PackedColorArray(0.04420001, 0.036399994, 0.13, 1, 0.043500025, 0, 0.29, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_0nril"]
gradient = SubResource("Gradient_338ij")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_b4j02"]
shader = ExtResource("2_a6wt5")
shader_parameter/gradient = SubResource("GradientTexture1D_0nril")
shader_parameter/curve = SubResource("CurveTexture_y7kw2")
shader_parameter/horizon = 0.650000030875
shader_parameter/draw_horizon = false

[sub_resource type="ViewportTexture" id="ViewportTexture_6acqj"]
viewport_path = NodePath("3DCloudsRender")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_b4j02"]
noise_type = 3
offset = Vector3(539.01, 0, 0)

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_lpqep"]
height = 64
noise = SubResource("FastNoiseLite_b4j02")
seamless = true
seamless_blend_skirt = 1.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_lpqep"]
shader = ExtResource("6_0nril")
shader_parameter/displacement_map = SubResource("NoiseTexture2D_lpqep")

[sub_resource type="Gradient" id="Gradient_p41gt"]
offsets = PackedFloat32Array(1)
colors = PackedColorArray(1, 1, 1, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_2rx0l"]
gradient = SubResource("Gradient_p41gt")
width = 512

[sub_resource type="Gradient" id="Gradient_y7kw2"]
offsets = PackedFloat32Array(0.4938575, 1)
colors = PackedColorArray(0.144, 0.26639995, 0.45, 0, 0.14509805, 0.26666668, 0.4509804, 0.5764706)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_338ij"]
gradient = SubResource("Gradient_y7kw2")

[sub_resource type="Gradient" id="Gradient_b4j02"]
colors = PackedColorArray(0.7, 0.7, 0.7, 1, 0.7611122, 0.7611122, 0.7611122, 1)

[sub_resource type="FastNoiseLite" id="FastNoiseLite_lpqep"]
noise_type = 3

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_p41gt"]
width = 256
height = 64
noise = SubResource("FastNoiseLite_lpqep")
color_ramp = SubResource("Gradient_b4j02")
seamless = true

[sub_resource type="ShaderMaterial" id="ShaderMaterial_338ij"]
shader = ExtResource("4_y7kw2")
shader_parameter/cloud_texture = ExtResource("5_338ij")
shader_parameter/displacement_map = SubResource("NoiseTexture2D_p41gt")
shader_parameter/cloud_color_map = SubResource("GradientTexture1D_338ij")
shader_parameter/uv_scale = Vector2(1, 1)

[sub_resource type="Gradient" id="Gradient_0nril"]
offsets = PackedFloat32Array(1)
colors = PackedColorArray(1, 1, 1, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_b4j02"]
gradient = SubResource("Gradient_0nril")
width = 640
height = 128

[node name="StormNight" type="CanvasLayer"]
layer = -1
script = ExtResource("1_llem3")
pause_gradient_map = SubResource("GradientTexture1D_6acqj")
metadata/_custom_type_script = "uid://ccysh3ski6mvh"

[node name="DirectionalLight2D" type="DirectionalLight2D" parent="."]
range_layer_min = -1
range_layer_max = -1
height = 0.12

[node name="PointLight2D" type="PointLight2D" parent="."]
position = Vector2(251, 157)
range_layer_min = -1
range_layer_max = -1
texture = SubResource("GradientTexture2D_p41gt")
texture_scale = 7.27

[node name="3DCloudsRender" type="SubViewport" parent="."]
own_world_3d = true
transparent_bg = true
size = Vector2i(1920, 1080)
size_2d_override_stretch = true
render_target_clear_mode = 1
render_target_update_mode = 0

[node name="WorldEnvironment" type="WorldEnvironment" parent="3DCloudsRender"]
environment = SubResource("Environment_6acqj")

[node name="Top" type="MeshInstance3D" parent="3DCloudsRender"]
transform = Transform3D(1, 0, 8.742278e-08, 0, -1, 0, 8.742278e-08, 0, -1, 0, 0.8, -0.71)
mesh = SubResource("PlaneMesh_y7kw2")
skeleton = NodePath("../..")

[node name="Bottom" type="MeshInstance3D" parent="3DCloudsRender"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.8, -0.71)
mesh = SubResource("PlaneMesh_b4j02")

[node name="Camera3D" type="Camera3D" parent="3DCloudsRender"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.06548804, -0.003462851, 0.6208296)

[node name="DirectionalLight3D" type="SpotLight3D" parent="3DCloudsRender"]
transform = Transform3D(1, 0, 0, 0, -1, -1.509958e-07, 0, 1.509958e-07, -1, 0, 0, 0)
visible = false
light_energy = 0.2
spot_range = 1.214
spot_angle = 90.0

[node name="Gradient" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_b4j02")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="3DClouds" type="TextureRect" parent="."]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("ViewportTexture_6acqj")
expand_mode = 1

[node name="Polygon2D" type="Polygon2D" parent="."]
material = SubResource("ShaderMaterial_lpqep")
position = Vector2(201, 133)
antialiased = true
texture = SubResource("GradientTexture2D_2rx0l")
polygon = PackedVector2Array(-128, 0, -127.725945, 1.04645, -126.904945, 2.088419, -125.54051, 3.1214452, -123.638504, 4.1411047, -121.207054, 5.1430316, -118.25658, 6.122935, -114.79971, 7.076619, -110.85125, 8, -106.42811, 8.889124, -101.549225, 9.740183, -96.2355, 10.549533, -90.50967, 11.313708, -84.39626, 12.029437, -77.92146, 12.693653, -71.11299, 13.303514, -64, 13.856406, -56.612953, 14.349964, -48.98348, 14.782072, -41.144253, 15.150882, -33.128838, 15.454813, -24.971561, 15.692564, -16.707352, 15.863118, -8.3716, 15.965743, -7.837481e-15, 16, 8.3716, 15.965743, 16.707352, 15.863118, 24.971561, 15.692564, 33.128838, 15.454813, 41.144253, 15.150882, 48.98348, 14.782072, 56.612953, 14.349964, 64, 13.856406, 71.11299, 13.303514, 77.92146, 12.693653, 84.39626, 12.029437, 90.50967, 11.313708, 96.2355, 10.549533, 101.549225, 9.740183, 106.42811, 8.889124, 110.85125, 8, 114.79971, 7.076619, 118.25658, 6.122935, 121.207054, 5.1430316, 123.638504, 4.1411047, 125.54051, 3.1214452, 126.904945, 2.088419, 127.725945, 1.04645, 128, 1.9593702e-15, 127.725945, -1.04645, 126.904945, -2.088419, 125.54051, -3.1214452, 123.638504, -4.1411047, 121.207054, -5.1430316, 118.25658, -6.122935, 114.79971, -7.076619, 110.85125, -8, 106.42811, -8.889124, 101.549225, -9.740183, 96.2355, -10.549533, 90.50967, -11.313708, 84.39626, -12.029437, 77.92146, -12.693653, 71.11299, -13.303514, 64, -13.856406, 56.612953, -14.349964, 48.98348, -14.782072, 41.144253, -15.150882, 33.128838, -15.454813, 24.971561, -15.692564, 16.707352, -15.863118, 8.3716, -15.965743, 2.3512442e-14, -16, -8.3716, -15.965743, -16.707352, -15.863118, -24.971561, -15.692564, -33.128838, -15.454813, -41.144253, -15.150882, -48.98348, -14.782072, -56.612953, -14.349964, -64, -13.856406, -71.11299, -13.303514, -77.92146, -12.693653, -84.39626, -12.029437, -90.50967, -11.313708, -96.2355, -10.549533, -101.549225, -9.740183, -106.42811, -8.889124, -110.85125, -8, -114.79971, -7.076619, -118.25658, -6.122935, -121.207054, -5.1430316, -123.638504, -4.1411047, -125.54051, -3.1214452, -126.904945, -2.088419, -127.725945, -1.04645)
uv = PackedVector2Array(-128, 0, -127.84582, 0.7850828, -127.383644, 1.5682743, -126.61459, 2.3476875, -125.54051, 3.1214452, -124.164, 3.887683, -122.488365, 4.6445546, -120.51764, 5.390238, -118.25658, 6.122935, -115.71063, 6.8408813, -112.885925, 7.542348, -109.78926, 8.225644, -106.42811, 8.889124, -102.81056, 9.531189, -98.945335, 10.150292, -94.84174, 10.744944, -90.50967, 11.313708, -85.95955, 11.855218, -81.20234, 12.368167, -76.24951, 12.85132, -71.11299, 13.303514, -65.80515, 13.723658, -60.338783, 14.110741, -54.72705, 14.463829, -48.98348, 14.782072, -43.121902, 15.064705, -37.156437, 15.311046, -31.101463, 15.5205, -24.971561, 15.692564, -18.7815, 15.826824, -12.546194, 15.9229555, -6.2806625, 15.980727, -7.837481e-15, 16, 6.2806625, 15.980727, 12.546194, 15.9229555, 18.7815, 15.826824, 24.971561, 15.692564, 31.101463, 15.5205, 37.156437, 15.311046, 43.121902, 15.064705, 48.98348, 14.782072, 54.72705, 14.463829, 60.338783, 14.110741, 65.80515, 13.723658, 71.11299, 13.303514, 76.24951, 12.85132, 81.20234, 12.368167, 85.95955, 11.855218, 90.50967, 11.313708, 94.84174, 10.744944, 98.945335, 10.150292, 102.81056, 9.531189, 106.42811, 8.889124, 109.78926, 8.225644, 112.885925, 7.542348, 115.71063, 6.8408813, 118.25658, 6.122935, 120.51764, 5.390238, 122.488365, 4.6445546, 124.164, 3.887683, 125.54051, 3.1214452, 126.61459, 2.3476875, 127.383644, 1.5682743, 127.84582, 0.7850828, 128, 1.9593702e-15, 127.84582, -0.7850828, 127.383644, -1.5682743, 126.61459, -2.3476875, 125.54051, -3.1214452, 124.164, -3.887683, 122.488365, -4.6445546, 120.51764, -5.390238, 118.25658, -6.122935, 115.71063, -6.8408813, 112.885925, -7.542348, 109.78926, -8.225644, 106.42811, -8.889124, 102.81056, -9.531189, 98.945335, -10.150292, 94.84174, -10.744944, 90.50967, -11.313708, 85.95955, -11.855218, 81.20234, -12.368167, 76.24951, -12.85132, 71.11299, -13.303514, 65.80515, -13.723658, 60.338783, -14.110741, 54.72705, -14.463829, 48.98348, -14.782072, 43.121902, -15.064705, 37.156437, -15.311046, 31.101463, -15.5205, 24.971561, -15.692564, 18.7815, -15.826824, 12.546194, -15.9229555, 6.2806625, -15.980727, 2.3512442e-14, -16, -6.2806625, -15.980727, -12.546194, -15.9229555, -18.7815, -15.826824, -24.971561, -15.692564, -31.101463, -15.5205, -37.156437, -15.311046, -43.121902, -15.064705, -48.98348, -14.782072, -54.72705, -14.463829, -60.338783, -14.110741, -65.80515, -13.723658, -71.11299, -13.303514, -76.24951, -12.85132, -81.20234, -12.368167, -85.95955, -11.855218, -90.50967, -11.313708, -94.84174, -10.744944, -98.945335, -10.150292, -102.81056, -9.531189, -106.42811, -8.889124, -109.78926, -8.225644, -112.885925, -7.542348, -115.71063, -6.8408813, -118.25658, -6.122935, -120.51764, -5.390238, -122.488365, -4.6445546, -124.164, -3.887683, -125.54051, -3.1214452, -126.61459, -2.3476875, -127.383644, -1.5682743, -127.84582, -0.7850828)
script = ExtResource("5_b4j02")
points = 96

[node name="VeryBack" type="Parallax2D" parent="."]
scroll_scale = Vector2(0.05, 0.05)
scroll_offset = Vector2(0, 108)
repeat_size = Vector2(1280, 0)
autoscroll = Vector2(-24, 0)
follow_viewport = false

[node name="TextureRect" type="TextureRect" parent="VeryBack"]
visible = false
material = SubResource("ShaderMaterial_338ij")
offset_right = 6400.0
offset_bottom = 360.0
texture = SubResource("GradientTexture2D_b4j02")
expand_mode = 1
stretch_mode = 1
